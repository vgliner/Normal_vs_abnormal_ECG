function correlation_grade=correlation_analyzer(cleaned_vector,q_vec,r_vec,s_vec,t_vec,p_vec)
%% Try to find Fluttter by correlation
flutter_wave=[-0.105000000000000;-0.105000000000000;-0.103000000000000;-0.102000000000000;-0.0990000000000000;-0.0970000000000000;-0.0940000000000000;-0.0910000000000000;-0.0890000000000000;-0.0860000000000000;-0.0840000000000000;-0.0810000000000000;-0.0800000000000000;-0.0790000000000000;-0.0790000000000000;-0.0790000000000000;-0.0780000000000000;-0.0750000000000000;-0.0710000000000000;-0.0650000000000000;-0.0590000000000000;-0.0540000000000000;-0.0480000000000000;-0.0430000000000000;-0.0390000000000000;-0.0350000000000000;-0.0320000000000000;-0.0300000000000000;-0.0280000000000000;-0.0270000000000000;-0.0260000000000000;-0.0230000000000000;-0.0200000000000000;-0.0170000000000000;-0.0140000000000000;-0.0100000000000000;-0.00700000000000000;-0.00500000000000000;-0.00400000000000000;-0.00400000000000000;-0.00600000000000000;-0.0100000000000000;-0.0140000000000000;-0.0190000000000000;-0.0240000000000000;-0.0290000000000000;-0.0350000000000000;-0.0410000000000000;-0.0470000000000000;-0.0520000000000000;-0.0560000000000000;-0.0590000000000000;-0.0610000000000000;-0.0640000000000000;-0.0650000000000000;-0.0670000000000000;-0.0670000000000000;-0.0680000000000000;-0.0680000000000000;-0.0700000000000000;-0.0710000000000000;-0.0720000000000000;-0.0740000000000000;-0.0750000000000000;-0.0760000000000000;-0.0780000000000000;-0.0790000000000000;-0.0800000000000000;-0.0810000000000000;-0.0810000000000000;-0.0800000000000000;-0.0800000000000000;-0.0800000000000000;-0.0790000000000000;-0.0780000000000000;-0.0760000000000000;-0.0730000000000000;-0.0710000000000000;-0.0690000000000000;-0.0680000000000000;-0.0670000000000000;-0.0650000000000000;-0.0630000000000000;-0.0600000000000000;-0.0570000000000000;-0.0540000000000000;-0.0510000000000000;-0.0470000000000000;-0.0410000000000000;-0.0340000000000000;-0.0270000000000000;-0.0210000000000000;-0.0170000000000000;-0.0140000000000000;-0.0120000000000000;-0.0100000000000000;-0.00700000000000000;-0.00500000000000000;-0.00300000000000000;0;0.00500000000000000;0.0100000000000000;0.0120000000000000;0.0110000000000000;0.00800000000000000;0.00600000000000000;0.00300000000000000;0;-0.00100000000000000;0;0.00100000000000000;0.00400000000000000;0.00700000000000000;0.00900000000000000;0.0120000000000000;0.0150000000000000;0.0180000000000000;0.0200000000000000;0.0190000000000000;0.0140000000000000;0.00800000000000000;0.00100000000000000;-0.00300000000000000;-0.00800000000000000;-0.0120000000000000;-0.0170000000000000;-0.0220000000000000;-0.0260000000000000;-0.0290000000000000;-0.0310000000000000;-0.0320000000000000;-0.0330000000000000;-0.0340000000000000;-0.0350000000000000;-0.0350000000000000;-0.0340000000000000;-0.0330000000000000;-0.0330000000000000;-0.0320000000000000;-0.0300000000000000;-0.0310000000000000;-0.0410000000000000;-0.0500000000000000;-0.0580000000000000;-0.0630000000000000;-0.0630000000000000];
bad_morphology_wave=[-0.0970000000000000;-0.0890000000000000;-0.0690000000000000;-0.0130000000000000;0.0620000000000000;0.171000000000000;0.313000000000000;0.487000000000000;0.686000000000000;0.891000000000000;1.07800000000000;1.21300000000000;1.23000000000000;1.18100000000000;0.978000000000000;0.678000000000000;0.325000000000000;-0.00100000000000000;-0.241000000000000;-0.373000000000000;-0.417000000000000;-0.429000000000000;-0.436000000000000;-0.441000000000000;-0.446000000000000;-0.449000000000000;-0.453000000000000;-0.455000000000000;-0.457000000000000;-0.459000000000000;-0.462000000000000;-0.466000000000000;-0.474000000000000;-0.477000000000000;-0.472000000000000;-0.457000000000000;-0.436000000000000;-0.401000000000000;-0.363000000000000;-0.322000000000000;-0.275000000000000;-0.230000000000000;-0.184000000000000;-0.141000000000000;-0.107000000000000;-0.0820000000000000;-0.0550000000000000;-0.0420000000000000;-0.0350000000000000;-0.0290000000000000;-0.0240000000000000;-0.0200000000000000;-0.0170000000000000;-0.0140000000000000;-0.0100000000000000;-0.00700000000000000;-0.00400000000000000;-0.00100000000000000;0.00100000000000000;0.00300000000000000;0.00500000000000000;0.00800000000000000;0.0110000000000000;0.0150000000000000;0.0190000000000000;0.0230000000000000;0.0280000000000000;0.0320000000000000;0.0370000000000000;0.0420000000000000;0.0490000000000000;0.0580000000000000;0.0720000000000000;0.0850000000000000;0.0970000000000000;0.110000000000000;0.122000000000000;0.136000000000000;0.152000000000000;0.166000000000000;0.176000000000000;0.187000000000000;0.197000000000000;0.205000000000000;0.214000000000000;0.225000000000000;0.238000000000000;0.248000000000000;0.254000000000000;0.258000000000000;0.262000000000000;0.266000000000000];
correlation_grade=0;
segments_counter=0;
% for counter=1:numel(q_vec)
%     try
%        suspected_vec=cleaned_vector(q_vec(counter)-numel(flutter_wave)+1:q_vec(counter));
%         norm_suspected_vec=(suspected_vec-min(suspected_vec))./(max(suspected_vec)-min(suspected_vec));
%         norm_flutter_wave=(flutter_wave-min(flutter_wave))./(max(flutter_wave)-min(flutter_wave));
% %         plot(norm_suspected_vec )
% %         hold on
% %         plot(norm_flutter_wave)        
%        max_corr= max(xcorr(norm_suspected_vec,norm_flutter_wave,'coeff' ));
%        correlation_grade=correlation_grade+max_corr;           
%        segments_counter=segments_counter+1;
%     catch
%         
%     end
% end
for counter=1:numel(q_vec)
    try
       suspected_vec=cleaned_vector(q_vec(counter):q_vec(counter)+numel(bad_morphology_wave)-1);
        norm_suspected_vec=(suspected_vec-min(suspected_vec))./(max(suspected_vec)-min(suspected_vec));
        norm_bad_morphology_wave=(bad_morphology_wave-min(bad_morphology_wave))./(max(bad_morphology_wave)-min(bad_morphology_wave));
%         plot(norm_suspected_vec )
%         hold on
%         plot(norm_flutter_wave)        
       max_corr= max(xcorr(norm_suspected_vec,norm_bad_morphology_wave,'coeff' ));
       correlation_grade=correlation_grade+max_corr;           
       segments_counter=segments_counter+1;
    catch
        
    end
end
correlation_grade=correlation_grade/segments_counter;